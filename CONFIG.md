
# Setting Up Drupal Grunt Build and Testing Tasks On Your Project

This document is a guide for integrating these tools with your Drupal project.

## Starting From The Example

The recommended starting point is to use the included kickstart example to
structure your Drupal project. To extract the example template, you can use the
following two commands:

1. In an empty directory, run:
   `npm install --save-dev grunt git+https://github.com/phase2/grunt-drupal-tasks.git`

2. Copy the contents of node_modules/grunt-drupal-tasks/example to the project
   directory, by running:
   `cp -rf node_modules/grunt-drupal-tasks/example/* .`

This should result in the following initial files and directories:

```
Gruntconfig.json
Gruntfile.js
behat.yml
composer.json
features/
  bootstrap/
node_modules/
  grunt/
  grunt-drupal-tasks/
package.json
phpmd.xml
src/
  modules/
  profiles/
  project.make
  sites/
  static/
  themes/
```

The first step is to configure the Drush make file and add your custom code and
configuration to the directories under _src/_.

- Place custom modules in *src/modules/*. When the project is built, the
  contents of src/modules/ become part of the Drupal's sites/all/modules/
  directory (via a symlink from sites/all/modules/custom/ to src/modules/).

- Place custom installation profiles in *src/profiles/*. When the project is
  built, the contents of src/profiles/ is copied into Drupal's profiles/
  directory.

- Include a Drush make file for the project. The example includes *project.make*
  but the name can be changed by updating Gruntconfig.json (see below). Grunt
  executes "drush make" with this file at the start of the build process.

- Include any sites directories (like "default"), optionally with settings.php
  or other files, and a multi-site sites.php, if needed, in *src/sites/*.

- Include any static files that should be copied into the Drupal docroot on
  build. This can be used for overriding files like .htaccess.

- Place custom themes in *src/themes/*. When the project is built, the
  contents of src/themes/ become part of the Drupal's sites/all/themes/
  directory (via a symlink from sites/all/themes/custom/ to src/themes/).

At this point, you should be able to run "grunt" to generate the basic build.
This should result in a fully-built Drupal site docroot in build/html/
that also includes any contrib modules, themes, and libraries specified in the
make file, and all custom code and settings include in src/.

## Configuration Options

This documents all configuration options for Drupal Grunt Build and Testing
Tasks. These options are defined in the Gruntconfig.json file.

### Core Configuration

The core set of configuration options for Gruntconfig.json specify the basic
build parameters: the code to build, and the output directories to use.

This is the minimum set of configuration options:

```
{
  "srcPaths": {
    "drupal": "src",
    "make": "src/project.make"
  },
  "buildPaths": {
    "build": "build",
    "html": "build/html",
    "package": "build/packages",
    "reports": "build/reports",
    "temp": "build/temp"
  }
}
```

*srcPaths.drupal*: Specifies the directory that contains all project-specific
Drupal code and configuration. Grunt Drupal Tasks assumes this directory has the
following structure:

```
src/
  modules/
  profiles/
  sites/
  static/
  themes/
```

*srcPaths.make*: Specifies the Drush make file used to build the Drupal project.

*buildPaths.build*: Specifies the directory that should be used for
miscellaneous build artifacts. This can be the parent directory of
buildPaths.html and buildPaths.reports.

*buildPaths.html*: Specifies the directory that should be used for the Drupal
docroot build destination generated by the default build operation.

*buildPaths.package*: Specifies the directory that should be used to store
packages generated on demand by the _package_ operation.

*buildPaths.reports*: Specifies the directory that should be used for output
from the analysis and validation tools.

*buildPaths.temp*: Specifies the directory that should be used for temporary
build artifacts. This can be a subdirectory of buildPaths.html.

### Analyze Tasks

*phpmd.configPath*

*phpmd.path*

### Behat

*siteUrls*

### Drush

*drush.make.args*

### Package

*packages.srcFiles*

*packages.projFiles*

### Theme

*themes*

### Validate

*phpcs.path*

*phpcs.standard*
